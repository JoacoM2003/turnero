{% extends "base.html" %}

{% block title %}Turnos disponibles{% endblock %}

{% block content %}
<h2>Turnos para {{ cancha.nombre }}</h2>

<form method="get" class="mb-3">
  <label for="fecha">Elegir fecha:</label>
  <input type="date" name="fecha" id="fecha" value="{{ fecha }}" required>
  <button class="btn btn-primary btn-sm" type="submit">Ver Turnos</button>
</form>

{% if fecha %}
  <h4>Fecha seleccionada: {{ fecha }}</h4>

  <ul class="list-group">
    {% for horario in horarios %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ horario.hora_inicio|time:"H:i" }} - {{ horario.hora_fin|time:"H:i" }}
        {{ horario.id}}

        {% if horario.id in horarios_reservados_usuario %}
          <a href="#" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#cancelModal{{ horario.id }}">Cancelar</a>

          <!-- Cancel Modal -->
          <div class="modal fade" id="cancelModal{{ horario.id }}" tabindex="-1" aria-labelledby="cancelModalLabel{{ horario.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="cancelModalLabel{{ horario.id }}">Confirmar Cancelación</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  ¿Está seguro que desea cancelar esta reserva?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                  <form method="post" action="{% url 'cancelar_turno' %}">
                    {% csrf_token %}
                    <input type="hidden" name="cancha_id" value="{{ cancha.id }}">
                    <input type="hidden" name="fecha" value="{{ fecha }}">
                    <input type="hidden" name="horario_id" value="{{ horario.id }}">
                    <button type="submit" class="btn btn-danger">Sí, Cancelar</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

        {% elif horario.id in horarios_reservados %}
          <span class="badge bg-danger">Reservado</span>
        {% else %}
          <a href="#" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#reserveModal{{ horario.id }}">Reservar</a>

          <!-- Reserve Modal -->
          <div class="modal fade" id="reserveModal{{ horario.id }}" tabindex="-1" aria-labelledby="reserveModalLabel{{ horario.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="reserveModalLabel{{ horario.id }}">Confirmar Reserva</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  ¿Está seguro que desea reservar este turno?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                  <form method="post" action="{% url 'reservar_turno' %}">
                    {% csrf_token %}
                    <input type="hidden" name="cancha_id" value="{{ cancha.id }}">
                    <input type="hidden" name="fecha" value="{{ fecha }}">
                    <input type="hidden" name="horario_id" value="{{ horario.id }}">
                    <button type="submit" class="btn btn-success">Sí, Reservar</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}

{% endblock %}

